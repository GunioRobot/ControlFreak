#!/usr/bin/perl
use strict;
use warnings;

use Getopt::Long;
use Pod::Usage;

my %options;

GetOptions(
    'y|yes'      => \$options{yes},
    'address=s'  => \$options{address},

    'h|help'     => \$options{help},
    'm|man'      => \$options{man},
) or pod2usage(2);

pod2usage(1)             if $options{help};
pod2usage(-verbose => 2) if $options{man};

my $command = shift;
my @svcrefs = @ARGV;

__END__

=head1 NAME

cfkctl - control ControlFreak!

=head1 SYNOPSIS

cfkctl [options] command [svcref ...]

 Options:
    -y, --yes           Run non-interactively without asking for confirmations
    -h, --help          Help
    -m, --man           More help
    --address=SOCK      Unix or tcp socket to connect to ControlFreak
                        [defaults to 127.0.0.1:11311]

 Commands:
    up                  Make sure service is up
    down                Make sure service is down
    restart             If service is up, restart it
    destroy             Down a service and deletes it
    list                List all services
    status              Print statuses of services

 Services references:
    all                 All known services [default]
    svcname             A string of the name of the service
    @tag                All services tagged with the tag C<tag>
    :status             All services of status C<status>

  List of statuses:
    up
    down
    failed   included in C<down>
    backoff  included in C<down>
    stopped  included in C<down>


=head1 OPTIONS

Please see L<SYNOPSIS>.

=head1 DESCRIPTION

B<cfkctl> is B<ControlFreak> command line interface, it connects to
the management port and issues commands to it.

=head1 EXAMPLES

    ## stop everything that is not already stopped
    cfkctl down all

    ## make sure all webs are up (FastCGI processes for instance)
    cfkctl up @webs

    ## start yuidd once but don't attempt to resuscitate if failed
    cfkctl once yuidd # Implementation??

    ## remove a service reference completely
    cfkctl destroy syncer
